# Configuration Antigravity - Guide Complet

## üéØ Vue d'ensemble

Antigravity est un syst√®me qui traite automatiquement les newsletters Medium Daily Digest pour cr√©er une interface web √©l√©gante de visualisation d'articles.

## üìÅ Fichier .env cr√©√©

Un fichier `.env` a √©t√© g√©n√©r√© automatiquement avec :
- ‚úÖ **DEEPL_API_KEY** : R√©cup√©r√©e depuis Vault
- ‚ö†Ô∏è  **GMAIL_USER** : √Ä compl√©ter manuellement
- ‚ö†Ô∏è  **GMAIL_PASS** : √Ä compl√©ter manuellement (App Password)

## üîß Configuration Gmail (OBLIGATOIRE)

### √âtape 1 : V√©rifier la validation en 2 √©tapes

Gmail requiert la validation en 2 √©tapes pour g√©n√©rer des App Passwords.

1. Aller sur : https://myaccount.google.com/security
2. Chercher "Validation en deux √©tapes"
3. Si pas activ√©e, l'activer maintenant

### √âtape 2 : G√©n√©rer un App Password

**IMPORTANT** : Ne jamais utiliser votre mot de passe Gmail normal !

1. Aller sur : https://myaccount.google.com/apppasswords
2. S√©lectionner "App" : **Mail**
3. S√©lectionner "Device" : **Other (Custom name)**
4. Entrer un nom : **Antigravity Medium**
5. Cliquer sur "Generate"
6. **Copier le mot de passe g√©n√©r√©** (16 caract√®res)
   Format : `xxxx xxxx xxxx xxxx`

### √âtape 3 : √âditer le fichier .env

```bash
nano /Users/adminmac/medium-datligent/.env
```

Modifier les lignes :

```bash
GMAIL_USER="votre-email@gmail.com"      # Votre adresse Gmail
GMAIL_PASS="abcd efgh ijkl mnop"        # Le App Password g√©n√©r√©
```

**Exemple complet** :
```bash
GMAIL_USER="john.doe@gmail.com"
GMAIL_PASS="abcd efgh ijkl mnop"
```

### √âtape 4 : V√©rifier

Sauvegarder et quitter (Ctrl+X, Y, Enter)

## üß™ Tester la configuration

### Test Gmail

```bash
cd /Users/adminmac/medium-datligent/ingestion
python3 -c "
import os
from dotenv import load_dotenv
load_dotenv('../.env')
print('GMAIL_USER:', os.getenv('GMAIL_USER'))
print('GMAIL_PASS:', '***' if os.getenv('GMAIL_PASS') else 'NOT SET')
print('DEEPL_API_KEY:', '***' if os.getenv('DEEPL_API_KEY') else 'NOT SET')
"
```

### Test IMAP Connection

```bash
cd /Users/adminmac/medium-datligent/ingestion
python3 -c "
import os
import imaplib
from dotenv import load_dotenv

load_dotenv('../.env')

try:
    mail = imaplib.IMAP4_SSL('imap.gmail.com')
    mail.login(os.getenv('GMAIL_USER'), os.getenv('GMAIL_PASS'))
    print('‚úÖ Connexion Gmail r√©ussie!')
    mail.logout()
except Exception as e:
    print('‚ùå Erreur:', e)
"
```

## üìä Environnement complet

Une fois configur√©, votre `.env` contiendra :

```bash
# Gmail (IMAP)
GMAIL_USER="votre-email@gmail.com"
GMAIL_PASS="votre-app-password"

# DeepL (Translation)
DEEPL_API_KEY="REDACTED"  # ‚úÖ Depuis Vault
```

## üöÄ Utilisation d'Antigravity

### Ingestion manuelle

```bash
cd /Users/adminmac/medium-datligent/ingestion
python3 ingest_medium.py
```

### Avec Docker Compose

```bash
cd /Users/adminmac/medium-datligent
docker-compose up -d
```

## üîÑ Rafra√Æchir les credentials

Si vous devez rafra√Æchir les credentials depuis Vault :

```bash
/Users/adminmac/vault-datligent/scripts/setup-antigravity-env.sh
```

Puis r√©-√©diter pour ajouter GMAIL_USER et GMAIL_PASS.

## üîê S√©curit√©

### Bonnes pratiques

- ‚úÖ Le fichier `.env` a des permissions 600 (lecture seule pour vous)
- ‚úÖ DeepL API Key provient de Vault (centralis√©)
- ‚úÖ N'incluez jamais le `.env` dans Git
- ‚úÖ Utilisez toujours un App Password, jamais votre mot de passe Gmail

### R√©vocation

Si votre App Password est compromis :

1. Aller sur : https://myaccount.google.com/apppasswords
2. Supprimer l'App Password "Antigravity Medium"
3. En g√©n√©rer un nouveau
4. Mettre √† jour le `.env`

## üÜò D√©pannage

### Erreur : "Authentication failed"

**Cause** : App Password incorrect ou validation 2 √©tapes non activ√©e

**Solutions** :
1. V√©rifier que la validation 2 √©tapes est activ√©e
2. R√©g√©n√©rer un App Password
3. Copier exactement le App Password (avec espaces)

### Erreur : "No module named 'dotenv'"

**Cause** : D√©pendances Python manquantes

**Solution** :
```bash
cd /Users/adminmac/medium-datligent/ingestion
pip install -r requirements.txt
```

### Erreur : "DEEPL_API_KEY invalid"

**Cause** : Cl√© DeepL expir√©e ou invalide

**Solution** :
```bash
# Mettre √† jour dans Vault
export VAULT_ADDR="http://localhost:8200"
export VAULT_TOKEN="REDACTED"
vault kv put datligent/mcp/shared/deepl api_key="NOUVELLE_CLE"

# R√©g√©n√©rer le .env
/Users/adminmac/vault-datligent/scripts/setup-antigravity-env.sh
```

## üìö Ressources

- [Gmail App Passwords](https://support.google.com/accounts/answer/185833)
- [DeepL API Documentation](https://www.deepl.com/docs-api)
- [Vault Documentation](/Users/adminmac/vault-datligent/README.md)

---

**Derni√®re mise √† jour** : 2025-11-21 19:57:34 CET
**Source** : Vault + Configuration manuelle
**Statut** : ‚ö†Ô∏è  Configuration incompl√®te - Gmail √† configurer
